# ğŸŸ¢ Codex è¿‡å¤œä»»åŠ¡æŒ‡å—

> **Epic**: frontend-v3  
> **æ‰§è¡Œæ¨¡å¼**: æ¨¡å¼ C - è¿‡å¤œæ‰§è¡Œ  
> **é¢„è®¡æ—¶é—´**: ~5.5 å°æ—¶  
> **å¼€å§‹æ—¶é—´**: 2026-01-29 æ™š

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

ä½ è´Ÿè´£ DragonFly å‰ç«¯ V3 é‡æ„ä¸­**æ€§èƒ½å…³é”®**çš„ä»£ç ï¼š

1. **å®æ—¶æ•°æ®å±‚** - WebSocket + tick ç¼“å†²
2. **SSE æµå¼å¯¹è¯** - å¸¦ seq å»é‡
3. **Kçº¿å›¾** - imperative æ›´æ–°
4. **Command Palette** - Cmd+K å¿«æ·é”®

**å·¥ä½œç›®å½•**: `client/src/refactor_v2/`

---

## ğŸ“š å¿…è¯»æ–‡æ¡£ï¼ˆå¼€å§‹å‰é˜…è¯»ï¼‰

1. `tasks/FutureShop/frontend-architecture-guide.md` - æ•°æ®æµæ¶æ„
2. `tasks/FutureShop/agent-task-spec.md` - API å¥‘çº¦
3. `FRONTEND_REFACTOR_REVIEW.md` - âš ï¸ **é‡ç‚¹é˜…è¯»ç¬¬ 431-758 è¡Œ**ï¼ˆCRITICAL é—®é¢˜ä¿®å¤æ–¹æ¡ˆï¼‰

---

## ğŸ”´ é‡è¦è§„åˆ™ (Oracle æœ€ç»ˆç‰ˆ)

1. **Gate 1 å±éšœ**: **ä¸¥ç¦åœ¨ GLM å®Œæˆ L-004 å‰å¯åŠ¨ C-001ã€‚** å¿…é¡»å…ˆå®Œæˆ Wave 0ï¼Œç„¶åç­‰å¾… GLM äº¤ä»˜ç±»å‹/Storeï¼ˆæ£€æŸ¥ `stores/market.store.ts` æ˜¯å¦å­˜åœ¨ï¼‰ã€‚
2. **Lockfile é”å®š**: **ç¦æ­¢è¿è¡Œ `pnpm add`ã€‚** æ‰€æœ‰ä¾èµ–ç”± GLM å®‰è£…ï¼Œä½ åªéœ€ç›´æ¥ `import` å³å¯ã€‚
3. **index.ts å›é¿**: **ç¦æ­¢ä¿®æ”¹ `types/index.ts` æˆ– `stores/index.ts`ã€‚** å¦‚æœéœ€è¦å¯¼å‡ºæ–°æ¨¡å—ï¼Œè¯·åœ¨åŒçº§ç›®å½•åˆ›å»º `codex.ts` ä¸´æ—¶å¯¼å‡ºï¼Œç”± Wave 4 æœ€ç»ˆåˆå¹¶ã€‚
4. **è®°å½•ä»»åŠ¡æ—¶é—´**: å¿…é¡»åœ¨æ¯ä¸ªä»»åŠ¡æ–‡ä»¶å¼€å¤´è®°å½• `å¼€å§‹æ—¶é—´` å’Œ `ç»“æŸæ—¶é—´`ã€‚
5. **æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡åè¿è¡Œ `pnpm check`**: ç¡®ä¿æ— ç±»å‹é”™è¯¯ã€‚
6. **å¿…é¡»åˆ›å»ºå•å…ƒæµ‹è¯•**: æ ¸å¿ƒæ¨¡å—éœ€è¦æµ‹è¯•è¦†ç›–ã€‚
7. **é‡åˆ°é˜»å¡æ—¶**: è®°å½•åˆ° `ISSUES.md`ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚

---

## âš ï¸ CRITICAL æ€§èƒ½è¦æ±‚

ä½ çš„ä»£ç ç›´æ¥å½±å“ 60fps ç¨³å®šæ€§ï¼Œå¿…é¡»éµå®ˆï¼š

1. **tick ä¸ç›´æ¥å†™ Zustand** â†’ èµ° tickBuffer + rAF
2. **SSE å¿…é¡» seq å»é‡** â†’ é˜²æ­¢é‡è¿åé‡å¤ token
3. **Kçº¿å›¾ imperative æ›´æ–°** â†’ ä¸ç»è¿‡ React state

---

## ğŸš¨ é—®é¢˜è®°å½•æ¨¡æ¿

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œåœ¨ `client/src/refactor_v2/ISSUES.md` ä¸­è®°å½•ï¼š

```markdown
### ğŸ”´ é˜»å¡: C-XXX

**æ—¶é—´**: YYYY-MM-DD HH:MM
**é—®é¢˜æè¿°**: ç®€è¿°é‡åˆ°çš„é—®é¢˜
**é”™è¯¯ä¿¡æ¯**: 
\`\`\`
ç²˜è´´å®Œæ•´é”™è¯¯ä¿¡æ¯
\`\`\`
**å°è¯•çš„è§£å†³æ–¹æ¡ˆ**: 
1. ...
2. ...
**å»ºè®®**: éœ€è¦ Amp Review ååŠ©
```

---

## ğŸ“Š ä»»åŠ¡æ‰§è¡Œé¡ºåº

### Wave 0: Oracle æŠ¤æ ï¼ˆå¿…é¡»ä¼˜å…ˆæ‰§è¡Œï¼ï¼‰

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|-----|------|------|----------|
| 0a | C-000 | C-000-connection-state-machine.md | 45 min |
| 0b | C-009 | C-009-realtime-debug.md | 20 min |

### Wave 1: å®æ—¶æ•°æ®å±‚ (â¸ï¸ å¿…é¡»ç­‰å¾… GLM L-004 å®Œæˆ)

> [!WARNING]
> **Gate 1**: åœ¨å¯åŠ¨ C-001 å‰ï¼Œè¯·ç¡®è®¤ `client/src/refactor_v2/stores/market.store.ts` å·²è¢« GLM åˆ›å»ºã€‚

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|-----|------|------|----------|
| 1 | C-001 | C-001-tick-buffer.md | 30 min |
| 2 | C-002 | C-002-market-client.md | 45 min |

### Wave 2: SSE æµå¼å¯¹è¯

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|-----|------|------|----------|
| 3 | C-003 | C-003-streaming-chat.md | 60 min |
| 4 | C-004 | C-004-streaming-markdown.md | 25 min |
| 5 | C-005 | C-005-tool-thinking-card.md | 40 min |

### Wave 3: Kçº¿ + WebSocket

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|-----|------|------|----------|
| 6 | C-006 | C-006-kline-panel.md | 60 min |
| 7 | C-007 | C-007-market-websocket-hook.md | 30 min |

### Wave 4: Command Palette

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|-----|------|------|----------|
| 8 | C-008 | C-008-command-palette.md | 40 min |

---

## ğŸ› ï¸ æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ­¥éª¤

1. **è¯»å–ä»»åŠ¡æ–‡ä»¶**ï¼š`tasks/epics/frontend-v3/codex/C-XXX-*.md`
2. **å¡«å†™å¼€å§‹æ—¶é—´**ï¼šåœ¨æ–‡ä»¶å¼€å¤´è®°å½•å½“å‰æ—¶é—´
3. **ç†è§£ç›®æ ‡**ï¼šæŸ¥çœ‹ä»»åŠ¡çš„ç›®æ ‡æ¸…å•
4. **æ‰§è¡Œæ­¥éª¤**ï¼šæŒ‰ç…§ Step 1, Step 2... ä¾æ¬¡æ‰§è¡Œ
5. **åˆ›å»ºæµ‹è¯•**ï¼šæ ¸å¿ƒæ¨¡å—å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
6. **éªŒè¯**ï¼šè¿è¡Œ `pnpm check` å’Œ `pnpm test`
7. **å¡«å†™ç»“æŸæ—¶é—´**ï¼šè®°å½•å®Œæˆæ—¶é—´å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# ç±»å‹æ£€æŸ¥
pnpm check

# è¿è¡Œç‰¹å®šæµ‹è¯•
pnpm test -- --grep "tickBuffer"
pnpm test -- --grep "marketClient"
pnpm test -- --grep "useStreamingChat"

# æ„å»ºæµ‹è¯•
pnpm build
```

---

## ğŸ“ æœ€ç»ˆç›®å½•ç»“æ„

å®Œæˆåï¼Œä½ åˆ›å»ºçš„æ–‡ä»¶ï¼š

```
refactor_v2/
â”œâ”€â”€ realtime/
â”‚   â”œâ”€â”€ tickBuffer.ts          # C-001
â”‚   â”œâ”€â”€ marketClient.ts        # C-002
â”‚   â””â”€â”€ __tests__/
â”‚       â”œâ”€â”€ tickBuffer.test.ts
â”‚       â””â”€â”€ marketClient.test.ts
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useStreamingChat.ts    # C-003
â”‚   â”œâ”€â”€ useStreamingMarkdown.ts # C-004
â”‚   â””â”€â”€ useMarketWebSocket.ts  # C-007
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ToolCard.tsx       # C-005
â”‚   â”‚   â””â”€â”€ ThinkingCard.tsx   # C-005
â”‚   â”œâ”€â”€ panels/
â”‚   â”‚   â””â”€â”€ KLinePanel.tsx     # C-006
â”‚   â””â”€â”€ CommandPalette.tsx     # C-008
```

## ğŸ“ index.ts è´£ä»»å½’å±

| æ–‡ä»¶ | è´Ÿè´£ Agent | å…¶ä»– Agent æƒé™ |
|------|-----------|----------------|
| types/index.ts | ğŸ”µ GLM (L-002/L-003) | åªè¯» |
| stores/index.ts | ğŸ”µ GLM (L-004) | ğŸŸ¢ Codex å¯è¿½åŠ  |
| hooks/index.ts | ğŸ”µ GLM (L-007) | ğŸŸ¢ Codex å¯è¿½åŠ  |
| realtime/index.ts | ğŸŸ¢ Codex (C-001) | åªè¯» |

## ğŸš¦ Wave Checkpoint

æ¯å®Œæˆä¸€ä¸ª Wave åæ‰§è¡Œï¼š

```bash
# 1. ç±»å‹æ£€æŸ¥
pnpm check

# 2. æ„å»ºéªŒè¯
pnpm build

# 3. è¿è¡Œæ ¸å¿ƒæµ‹è¯•
pnpm test -- --grep "core"

# 4. æäº¤æ£€æŸ¥ç‚¹
git add client/src/refactor_v2/
git commit -m "checkpoint: Codex wave-N complete"
```

âš ï¸ å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼š
1. **å…ˆå°è¯•è‡ªè¡Œä¿®å¤**ï¼ˆå¦‚ç±»å‹å†²çªã€ç¼ºå¤±ä¾èµ–ï¼‰
2. ä¿®å¤æ— æœåˆ™**è·³è¿‡è¯¥æ£€æŸ¥æ­¥éª¤ï¼Œç»§ç»­åç»­ä»»åŠ¡**
3. å°†é—®é¢˜è®°å½•åˆ° ISSUES.mdï¼Œ**ç»ä¸åœæ­¢æ‰§è¡Œ**

---

## âœ… å®Œæˆåæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ 8 ä¸ªä»»åŠ¡å·²å®Œæˆ
- [ ] `pnpm check` æ— é”™è¯¯
- [ ] `pnpm test` é€šè¿‡ï¼ˆæ ¸å¿ƒæ¨¡å—æœ‰æµ‹è¯•ï¼‰
- [ ] 60fps ç¨³å®šæ€§æµ‹è¯•é€šè¿‡
- [ ] `ISSUES.md` å·²è®°å½•ä»»ä½•é—®é¢˜

---

**å¼€å§‹æ‰§è¡Œå§ï¼ä» C-001 å¼€å§‹ã€‚Good luck! ğŸš€**
