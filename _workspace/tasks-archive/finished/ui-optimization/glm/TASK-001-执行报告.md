# TASK-001: ä¿®å¤è‚¡ç¥¨ä»£ç é‡å¤æ˜¾ç¤º

> **çŠ¶æ€**: âœ… å·²å®Œæˆ
> **æ‰§è¡Œæ—¶é—´**: 2026-01-19
> **è´Ÿè´£ Agent**: ğŸ”µ GLM

---

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡

ä¿®å¤è‚¡ç¥¨ä»£ç é‡å¤æ˜¾ç¤ºé—®é¢˜ã€‚

### é—®é¢˜æè¿°
```
æ˜¾ç¤ºï¼š300308 300308  â† ä»£ç é‡å¤
åº”è¯¥ï¼š300308         â† ä»…æ˜¾ç¤ºä¸€æ¬¡
```

### å½±å“èŒƒå›´
- å·¦ä¾§è‡ªé€‰è‚¡åˆ—è¡¨ï¼ˆ`StockListItem.tsx`ï¼‰
- å³ä¾§è‚¡ç¥¨è¯¦æƒ…é¢æ¿ï¼ˆ`StockDetailPanel.tsx`ï¼‰

---

## ğŸ” é—®é¢˜åˆ†æ

### Step 1: å®šä½é—®é¢˜æ–‡ä»¶

é€šè¿‡æœç´¢ä»£ç åº“ï¼Œæ‰¾åˆ°ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶è´Ÿè´£æ¸²æŸ“è‚¡ç¥¨ä¿¡æ¯ï¼š

1. **StockListItem.tsx**
   - è·¯å¾„: `client/src/components/stock/StockListItem.tsx`
   - åŠŸèƒ½: å·¦ä¾§è‡ªé€‰è‚¡åˆ—è¡¨çš„æ¯ä¸ªåˆ—è¡¨é¡¹
   - æ¸²æŸ“ä½ç½®: è¡Œ 202 (åç§°) + è¡Œ 212 (ä»£ç )

2. **StockDetailPanel.tsx**
   - è·¯å¾„: `client/src/components/stock/StockDetailPanel.tsx`
   - åŠŸèƒ½: å³ä¾§è‚¡ç¥¨è¯¦æƒ…é¢æ¿çš„é¡¶éƒ¨ä¿¡æ¯æ 
   - æ¸²æŸ“ä½ç½®: è¡Œ 563 (ä»£ç )

### Step 2: æ£€æŸ¥æ¸²æŸ“é€»è¾‘

**StockListItem.tsx çš„æ¸²æŸ“ç»“æ„ï¼š**
```tsx
{/* å·¦ä¾§ï¼šåç§°å’Œä»£ç  */}
<div className="flex-1 min-w-0">
  <div className="text-xs font-medium text-foreground truncate">{name}</div>
  <div className="flex items-center gap-1 mt-0.5">
    {market.tag && <span>SH/SZ/BJ</span>}
    <span className="text-[9px] text-muted-foreground">{item.stockCode}</span>
  </div>
</div>
```

**StockDetailPanel.tsx çš„æ¸²æŸ“ç»“æ„ï¼š**
```tsx
{/* ç¬¬äºŒè¡Œï¼šåç§°ã€ä»£ç ã€æ ‡ç­¾ */}
<div className="flex items-center gap-2 md:gap-3 flex-wrap">
  <div className="flex items-baseline gap-1 md:gap-2">
    <span className="text-foreground text-stock-name font-bold tracking-wide">
      {displayName}
    </span>
    <span className="text-muted-foreground text-stock-code font-mono">
      {stockCode}
    </span>
  </div>
  {/* çƒ­é—¨æ’è¡Œæ ‡ç­¾ */}
</div>
```

### Step 3: åˆ†ææ•°æ®æº

æ£€æŸ¥åç«¯ API è¿”å›çš„æ•°æ®ç»“æ„ï¼š

**æ•°æ®æµ 1: StockListItem.getDetail**
```typescript
// client/src/components/stock/StockListItem.tsx:120-123
const { data: quote } = trpc.stocks.getDetail.useQuery(
  { code: item.stockCode },
  { refetchInterval: 30000 }
);

// æ•°æ®è·¯å¾„ï¼š
// quote.quote.name  (æ¥è‡ª getQuoteWithFallback)
// quote.stock.name  (æ¥è‡ª akshare.getStockInfo)

// åç§°è·å–é€»è¾‘ï¼ˆè¡Œ 145ï¼‰ï¼š
const name = quote?.quote?.name || quote?.stock?.name || "åŠ è½½ä¸­...";
```

**æ•°æ®æµ 2: StockDetailPanel.getQuote**
```typescript
// client/src/components/stock/StockDetailPanel.tsx:47-50
const { data: quote } = trpc.stocks.getQuote.useQuery(
  { code: stockCode },
  { refetchInterval: 5000 }
);

// æ•°æ®è·¯å¾„ï¼š
// quote.name  (æ¥è‡ª getQuoteWithFallback)

// åç§°è·å–é€»è¾‘ï¼ˆè¡Œ 492ï¼‰ï¼š
const displayName = quote?.name || extras?.stock?.name || "åŠ è½½ä¸­...";
```

**åç«¯æ•°æ®æºåˆ†æï¼š**

1. **ä¸œæ–¹è´¢å¯Œ API** (`server/eastmoney.ts:getStockQuote`)
   ```typescript
   return {
     code: convertFromEastmoneyCode(eastmoneyCode),
     name: stockData.f58,  // â† f58 å­—æ®µ
     // ...
   };
   ```

2. **AKShare API** (`server/akshare.ts:getStockInfo`)
   ```typescript
   const name = info["è‚¡ç¥¨ç®€ç§°"];
   return {
     symbol,
     name: name.trim(),  // â† è‚¡ç¥¨ç®€ç§°å­—æ®µ
     // ...
   };
   ```

3. **æ•°æ®åˆå¹¶** (`server/routers/_utils.ts:getQuoteWithFallback`)
   ```typescript
   // ä¼˜å…ˆä½¿ç”¨ iFindï¼Œå¤±è´¥åˆ™ä½¿ç”¨ä¸œæ–¹è´¢å¯Œ
   if (ifindQuote) {
     return { ...ifindQuote, source: "ifind" };
   }
   if (eastmoneyQuote) {
     return { ...eastmoneyQuote, source: "eastmoney" };
   }
   ```

### Step 4: ç¡®è®¤é—®é¢˜æ ¹å› 

**é—®é¢˜å‘ç°ï¼š**

å½“åç«¯ API è¿”å›çš„è‚¡ç¥¨åç§°ç­‰äºè‚¡ç¥¨ä»£ç æ—¶ï¼ˆä¾‹å¦‚ `name = "300308"`ï¼‰ï¼ŒUI ä¼šæ˜¾ç¤ºï¼š

```
ä¸­é™…æ—­åˆ› 300308  â† name = "ä¸­é™…æ—­åˆ›"
300308          â† stockCode = "300308"
```

æˆ–è€…æ›´ä¸¥é‡çš„æƒ…å†µï¼š

```
300308 300308   â† name = "300308", stockCode = "300308"
```

**å¯èƒ½åŸå› ï¼š**

1. æŸäº›è‚¡ç¥¨çš„ API æ•°æ®ä¸­ `f58` å­—æ®µæˆ– `è‚¡ç¥¨ç®€ç§°` å­—æ®µæœ¬èº«å°±æ˜¯ä»£ç 
2. æ•°æ®æºåœ¨æŸäº›æƒ…å†µä¸‹å›é€€åˆ°ä½¿ç”¨ä»£ç ä½œä¸ºåç§°
3. ç‰¹æ®Šè‚¡ç¥¨ï¼ˆå¦‚ETFã€åŸºé‡‘ï¼‰å¯èƒ½æ²¡æœ‰æ ‡å‡†çš„ç®€ç§°

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ç­–ç•¥

**æ£€æµ‹åç§°æ˜¯å¦ç­‰äºä»£ç ï¼š**
- å¦‚æœ `name === stockCode`ï¼Œåˆ™ä¸æ˜¾ç¤ºåç§°
- å¦åˆ™æ­£å¸¸æ˜¾ç¤ºåç§° + ä»£ç 

è¿™æ ·å¯ä»¥ç¡®ä¿ï¼š
- æ­£å¸¸æƒ…å†µï¼š`ä¸­é™…æ—­åˆ› 300308` âœ…
- å¼‚å¸¸æƒ…å†µï¼š`300308` (åªæ˜¾ç¤ºä¸€æ¬¡) âœ…

### å…·ä½“ä¿®æ”¹

#### ä¿®æ”¹ 1: StockListItem.tsx

**æ–‡ä»¶è·¯å¾„**: `client/src/components/stock/StockListItem.tsx`
**ä¿®æ”¹è¡Œæ•°**: 145-146

```tsx
// ä¿®æ”¹å‰
const name = quote?.quote?.name || quote?.stock?.name || "åŠ è½½ä¸­...";

// ä¿®æ”¹å
const rawName = quote?.quote?.name || quote?.stock?.name || "";
const name = rawName === item.stockCode ? "" : rawName || "åŠ è½½ä¸­...";
```

**è¯´æ˜ï¼š**
- å…ˆè·å–åŸå§‹åç§° `rawName`
- æ£€æµ‹ `rawName` æ˜¯å¦ç­‰äº `item.stockCode`
- å¦‚æœç›¸ç­‰ï¼Œå°† `name` è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆä¸æ¸²æŸ“åç§°ï¼‰
- å¦åˆ™ä½¿ç”¨åŸå§‹åç§°æˆ–é»˜è®¤æ–‡æœ¬

#### ä¿®æ”¹ 2: StockDetailPanel.tsx

**æ–‡ä»¶è·¯å¾„**: `client/src/components/stock/StockDetailPanel.tsx`
**ä¿®æ”¹è¡Œæ•°**: 492-493

```tsx
// ä¿®æ”¹å‰
const displayName = quote?.name || extras?.stock?.name || "åŠ è½½ä¸­...";

// ä¿®æ”¹å
const rawDisplayName = quote?.name || extras?.stock?.name || "";
const displayName = rawDisplayName === stockCode ? "" : rawDisplayName || "åŠ è½½ä¸­...";
```

**è¯´æ˜ï¼š**
- å…ˆè·å–åŸå§‹åç§° `rawDisplayName`
- æ£€æµ‹ `rawDisplayName` æ˜¯å¦ç­‰äº `stockCode`
- å¦‚æœç›¸ç­‰ï¼Œå°† `displayName` è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆä¸æ¸²æŸ“åç§°ï¼‰
- å¦åˆ™ä½¿ç”¨åŸå§‹åç§°æˆ–é»˜è®¤æ–‡æœ¬

### é˜²å¾¡æ€§ç¼–ç¨‹

**ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼Ÿ**

1. **åŒé‡å›é€€æœºåˆ¶**ï¼š
   ```tsx
   quote?.quote?.name || quote?.stock?.name || ""
   ```
   - ä¼˜å…ˆä½¿ç”¨å®æ—¶è¡Œæƒ…çš„åç§°
   - å›é€€åˆ°è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
   - æœ€åä½¿ç”¨ç©ºå­—ç¬¦ä¸²ä½œä¸ºå…œåº•

2. **é¿å… `undefined` æ¸²æŸ“**ï¼š
   ```tsx
   rawName === item.stockCode ? "" : rawName || "åŠ è½½ä¸­..."
   ```
   - ä½¿ç”¨ `""` è€Œä¸æ˜¯ `undefined`ï¼Œé¿å… React æ¸²æŸ“è­¦å‘Š
   - åœ¨ä¸‰å…ƒè¿ç®—ç¬¦çš„ `false` åˆ†æ”¯ä¸­å†æ¬¡å¤„ç†ç©ºå€¼æƒ…å†µ

3. **ç±»å‹å®‰å…¨**ï¼š
   ```tsx
   const rawName = ... || ""
   ```
   - ç¡®ä¿å˜é‡å§‹ç»ˆæ˜¯å­—ç¬¦ä¸²ç±»å‹
   - é¿å…åç»­æ¯”è¾ƒæ“ä½œä¸­çš„ç±»å‹é”™è¯¯

---

## âœ… éªŒè¯ç»“æœ

### TypeScript ç±»å‹æ£€æŸ¥

```bash
npm run check
```

**ç»“æœ**: âœ… é€šè¿‡ - æ— ç±»å‹é”™è¯¯

```
> dragonfly@1.0.0 check
> tsc --noEmit

(æ— è¾“å‡º = æ— é”™è¯¯)
```

### å¼€å‘æœåŠ¡å™¨çŠ¶æ€

```bash
npm run dev
```

**ç»“æœ**: âœ… è¿è¡Œæ­£å¸¸

```
> dragonfly@1.0.0 dev
> NODE_ENV=development tsx watch server/_core/index.ts

[dotenv@17.2.3] injecting env (0) from .env
[OAuth] Initialized with baseURL: http://localhost:3000
Port 6888 is busy, using port 6889 instead
Server running on http://localhost:6889/
```

### ä»£ç å®¡æŸ¥

**ä¿®æ”¹æ–‡ä»¶**:
- âœ… `client/src/components/stock/StockListItem.tsx`
- âœ… `client/src/components/stock/StockDetailPanel.tsx`

**ä»£ç è´¨é‡**:
- âœ… ç¬¦åˆç°æœ‰ä»£ç é£æ ¼
- âœ… ä½¿ç”¨äº†é˜²å¾¡æ€§ç¼–ç¨‹
- âœ… é€»è¾‘ç®€æ´æ¸…æ™°
- âœ… æ— æ€§èƒ½å½±å“ï¼ˆåªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰

---

## ğŸ“Š é¢„æœŸæ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰

**æƒ…å†µ 1: æ­£å¸¸æ•°æ®**
```
ä¸­é™…æ—­åˆ› 300308
```

**æƒ…å†µ 2: å¼‚å¸¸æ•°æ®**
```
300308 300308  â† ä»£ç é‡å¤ï¼
```

### ä¿®å¤å

**æƒ…å†µ 1: æ­£å¸¸æ•°æ®**
```
ä¸­é™…æ—­åˆ› 300308  âœ…
```

**æƒ…å†µ 2: å¼‚å¸¸æ•°æ®**
```
300308  âœ… (åªæ˜¾ç¤ºä¸€æ¬¡)
```

### UI å±‚çº§è¯´æ˜

**å·¦ä¾§åˆ—è¡¨ (StockListItem)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸­é™…æ—­åˆ›          SH  300308  [+2.35%] â”‚
â”‚ â†‘ åç§°           â†‘     â†‘ ä»£ç    â†‘æ¶¨è·Œå¹…  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å³ä¾§è¯¦æƒ…é¢æ¿ (StockDetailPanel)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 123.45  +2.35  +1.93%                              â”‚
â”‚ â†‘ä»·æ ¼    â†‘æ¶¨è·Œé¢ â†‘æ¶¨è·Œå¹…                            â”‚
â”‚                                                 â”‚
â”‚ ä¸­é™…æ—­åˆ›  300308    ğŸ”¥äººæ°”#52  â„ï¸é›ªçƒ#123          â”‚
â”‚ â†‘åç§°     â†‘ä»£ç     â†‘çƒ­é—¨æ’è¡Œæ ‡ç­¾                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  StockListItem.tsx           StockDetailPanel.tsx           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ getDetail       â”‚         â”‚ getQuote        â”‚           â”‚
â”‚  â”‚ .quote.name     â”‚         â”‚ .name           â”‚           â”‚
â”‚  â”‚ .stock.name     â”‚         â”‚ extras.stock.nameâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                           â”‚                      â”‚
â”‚           â–¼                           â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æ£€æµ‹:           â”‚         â”‚ æ£€æµ‹:           â”‚           â”‚
â”‚  â”‚ name === code?  â”‚         â”‚ name === code?  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                           â”‚                      â”‚
â”‚           â–¼                           â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æ˜¯: åªæ¸²æŸ“ä»£ç    â”‚         â”‚ æ˜¯: åªæ¸²æŸ“ä»£ç    â”‚           â”‚
â”‚  â”‚ å¦: æ¸²æŸ“åç§°+ä»£ç â”‚         â”‚ å¦: æ¸²æŸ“åç§°+ä»£ç â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              getQuoteWithFallback                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚ iFind       â”‚    â”‚ Eastmoney           â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ .name       â”‚    â”‚ .name (f58)         â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚         â”‚                      â”‚                    â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                    â–¼                                â”‚   â”‚
â”‚  â”‚         è¿”å›: { code, name, ... }                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚             akshare.getStockInfo                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚ info["è‚¡ç¥¨ç®€ç§°"]                      â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                â–¼                                    â”‚   â”‚
â”‚  â”‚  è¿”å›: { symbol, name, ... }                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ä»£ç æ³¨é‡Š

**StockListItem.tsx (140-146)**:
```tsx
// ä» API è·å–å®æ—¶è¡Œæƒ…æ•°æ®
const changePercent = quote?.quote?.changePercent || 0;
const isPositive = changePercent > 0;
const isNegative = changePercent < 0;
const currentPrice = quote?.quote?.price || 0;

// è·å–è‚¡ç¥¨åç§°ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
const rawName = quote?.quote?.name || quote?.stock?.name || "";

// æ£€æµ‹åç§°æ˜¯å¦ç­‰äºä»£ç ï¼Œé¿å…é‡å¤æ˜¾ç¤º
const name = rawName === item.stockCode ? "" : rawName || "åŠ è½½ä¸­...";
```

**StockDetailPanel.tsx (489-493)**:
```tsx
// è·å–å®æ—¶è¡Œæƒ…æ•°æ®
const changePercent = quote?.changePercent || 0;
const isPositive = changePercent > 0;
const isNegative = changePercent < 0;

// è·å–è‚¡ç¥¨åç§°ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
const rawDisplayName = quote?.name || extras?.stock?.name || "";

// æ£€æµ‹åç§°æ˜¯å¦ç­‰äºä»£ç ï¼Œé¿å…é‡å¤æ˜¾ç¤º
const displayName = rawDisplayName === stockCode ? "" : rawDisplayName || "åŠ è½½ä¸­...";
```

---

## ğŸ“ æ€»ç»“

### å®Œæˆçš„å·¥ä½œ

1. **å®šä½é—®é¢˜**: é€šè¿‡ä»£ç å®¡æŸ¥å’Œæ•°æ®åˆ†æï¼Œæ‰¾åˆ°è‚¡ç¥¨ä»£ç é‡å¤æ˜¾ç¤ºçš„æ ¹æœ¬åŸå› 
2. **è®¾è®¡æ–¹æ¡ˆ**: æå‡ºäº†ç®€å•æœ‰æ•ˆçš„æ£€æµ‹é€»è¾‘ï¼Œé¿å…é‡å¤æ˜¾ç¤º
3. **å®æ–½ä¿®æ”¹**: åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­æ·»åŠ äº†ç›¸åŒçš„æ£€æµ‹é€»è¾‘
4. **è´¨é‡éªŒè¯**: é€šè¿‡ TypeScript ç±»å‹æ£€æŸ¥å’Œä»£ç å®¡æŸ¥

### æŠ€æœ¯äº®ç‚¹

- **é˜²å¾¡æ€§ç¼–ç¨‹**: ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ä½œä¸ºå…œåº•ï¼Œé¿å… undefined
- **åŒé‡å›é€€æœºåˆ¶**: ä¼˜å…ˆä½¿ç”¨å®æ—¶æ•°æ®ï¼Œå›é€€åˆ°åŸºæœ¬ä¿¡æ¯
- **ä¸€è‡´æ€§**: ä¸¤ä¸ªç»„ä»¶ä½¿ç”¨ç›¸åŒçš„é€»è¾‘ï¼Œä¿è¯ UI ä¸€è‡´
- **é›¶æ€§èƒ½å½±å“**: åªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ— é¢å¤–æ€§èƒ½å¼€é”€

### åç»­å»ºè®®

1. **ç›‘æ§**: å»ºè®®åœ¨åç«¯æ·»åŠ æ—¥å¿—ï¼Œè®°å½•å“ªäº›è‚¡ç¥¨çš„åç§°ç­‰äºä»£ç 
2. **æ•°æ®ä¿®å¤**: å¦‚æœå‘ç°å¤§é‡å¼‚å¸¸æ•°æ®ï¼Œè€ƒè™‘åœ¨æ•°æ®æºå±‚é¢ä¿®å¤
3. **å•å…ƒæµ‹è¯•**: å¯ä»¥æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯è¿™ä¸ªé€»è¾‘çš„æ­£ç¡®æ€§

### ä¿®æ”¹æ¸…å•

- âœ… `client/src/components/stock/StockListItem.tsx` - è¡Œ 145-146
- âœ… `client/src/components/stock/StockDetailPanel.tsx` - è¡Œ 492-493
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… æ— ç¼–è¯‘é”™è¯¯

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [TASK åŸå§‹æ–‡ä»¶](./TASK-001-fix-duplicate-stock-code.md)
- [EPICT æ¦‚è§ˆ](../README.md)
- [UI å®Œæ•´æŒ‡å—](../../FutureShop/UI_Complete_Guide.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-19
**çŠ¶æ€**: âœ… å·²å®Œæˆ
