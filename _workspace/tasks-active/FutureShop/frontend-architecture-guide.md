# ğŸ—ï¸ å‰ç«¯æ¶æ„ä¸é¢æ¿ç³»ç»Ÿå®Œå…¨æŒ‡å—

**ç‰ˆæœ¬**: 1.0 | **æ—¥æœŸ**: 2026-01-29 | **å‚è€ƒ**: Manus å·¥ä½œæµ UI + TradingView Lightweight Charts

---

## ğŸ“ å¸ƒå±€æ¶æ„ï¼ˆ3 æ æ¨¡å‹ï¼‰

### æ€»ä½“ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¡¶éƒ¨å¯¼èˆªæ  (Header)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            â”‚                       â”‚                 â”‚
â”‚  å·¦ä¾§      â”‚     ä¸­é—´èŠå¤©å·¥ä½œåŒº    â”‚  å³ä¾§è‚¡ç¥¨å·¥ä½œå°  â”‚
â”‚  Sidebar   â”‚   Chat Workspace      â”‚ Stock Workspace â”‚
â”‚            â”‚                       â”‚                 â”‚
â”‚ - å¯¼èˆª     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ - è‡ªé€‰åˆ—è¡¨ â”‚ â”‚  æ¶ˆæ¯åˆ—è¡¨       â”‚  â”‚ â”‚   Symbol    â”‚ â”‚
â”‚ - æœ€è¿‘è‚¡   â”‚ â”‚  (æµå¼æ¸²æŸ“)     â”‚  â”‚ â”‚  Selector   â”‚ â”‚
â”‚ - è®¾ç½®     â”‚ â”‚                 â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚            â”‚ â”‚ - User Msg      â”‚  â”‚ â”‚   Panel     â”‚ â”‚
â”‚            â”‚ â”‚ - AI Msg        â”‚  â”‚ â”‚   Tabs      â”‚ â”‚
â”‚            â”‚ â”‚ - Tool Steps    â”‚  â”‚ â”‚ kçº¿ åˆ†æ—¶ ç›˜å£â”‚ â”‚
â”‚            â”‚ â”‚ - Thinking      â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚            â”‚ â”‚                 â”‚  â”‚ â”‚   Active    â”‚ â”‚
â”‚            â”‚ â”‚ (è‡ªåŠ¨æ»šåŠ¨åˆ°åº•)  â”‚  â”‚ â”‚   Panel     â”‚ â”‚
â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  Content    â”‚ â”‚
â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚             â”‚ â”‚
â”‚            â”‚ â”‚  è¾“å…¥æ¡†         â”‚  â”‚ â”‚   Kçº¿å›¾     â”‚ â”‚
â”‚            â”‚ â”‚  (Ctrl+Enter)   â”‚  â”‚ â”‚   æˆ–å…¶ä»–    â”‚ â”‚
â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                       â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å“åº”å¼æ–­ç‚¹
| å±å¹• | å¸ƒå±€ | å¤‡æ³¨ |
|------|------|------|
| 1024px+ | ä¸‰æ ï¼ˆ1:2:1.5ï¼‰ | æ¡Œé¢ç«¯ï¼Œå®Œæ•´å±•ç¤º |
| 768-1023px | äºŒæ ï¼ˆä¸­+å³ï¼‰ | éšè—å·¦ä¾§å¯¼èˆªï¼Œç”¨é¡¶éƒ¨èœå•æ›¿ä»£ |
| <768px | å•æ ï¼ˆä¸­ï¼‰ | ç§»åŠ¨ç«¯ï¼ŒèŠå¤©ä¼˜å…ˆï¼Œè‚¡ç¥¨é¢æ¿åé€€ä¸€å±‚ï¼ˆtab åˆ‡æ¢ï¼‰ |

---

## ğŸ’¬ ä¸­é—´åŒºï¼šå¯¹è¯å·¥ä½œåŒºï¼ˆChat Workspaceï¼‰

### æ¶ˆæ¯ç±»å‹ä¸æ¸²æŸ“

#### 1. User Messageï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ ç”¨æˆ· (14:23)                â”‚
â”‚                                â”‚
â”‚ å¸®æˆ‘åˆ†æä¸€ä¸‹AAPLæœ€è¿‘çš„èµ°åŠ¿    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ ·å¼ï¼š
- èƒŒæ™¯è‰²ï¼šæµ…ç°ï¼ˆ`bg-gray-100` æˆ– dark mode `bg-gray-800`ï¼‰
- æ–‡å­—å¯¹é½ï¼šå·¦å¯¹é½
- æ—¶é—´æˆ³ï¼šæ·¡è‰²å°å­—
- å¤´åƒï¼šå¯é€‰

ä»£ç ï¼š
```tsx
<div className="flex gap-3 mb-4">
  <Avatar name="User" />
  <div className="flex-1">
    <div className="text-sm text-gray-500 mb-1">
      ç”¨æˆ· â€¢ {formatTime(msg.timestamp)}
    </div>
    <div className="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg rounded-bl-none">
      {msg.content}
    </div>
  </div>
</div>
```

#### 2. Assistant Messageï¼ˆAI å›å¤ï¼Œæµå¼ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI Agent (14:24)            â”‚
â”‚                                â”‚
â”‚ åŸºäºæœ€æ–°æ•°æ®ï¼ŒAAPL å‘ˆç°...    â”‚
â”‚ - æŠ€æœ¯é¢ï¼šä¸Šå‡è¶‹åŠ¿            â”‚
â”‚ - åŸºæœ¬é¢ï¼šç›ˆåˆ©ç¨³å®š            â”‚
â”‚ - å»ºè®®ï¼šç»§ç»­æŒæœ‰              â”‚
â”‚                                â”‚
â”‚ [å±•å¼€è¯¦ç»†åˆ†æ] [åŠ å…¥è‡ªé€‰]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‰¹ç‚¹ï¼š
- æ”¯æŒ **Markdown æ¸²æŸ“**ï¼ˆè¡¨æ ¼ã€åˆ—è¡¨ã€ä»£ç å—ï¼‰
- **æµå¼è¾“å‡º**ï¼šé€å­—æ¸²æŸ“ï¼Œç”¨éª¨æ¶å±å ä½
- **å¯äº¤äº’**ï¼šåº•éƒ¨æŒ‰é’®å¡ç‰‡å¯ç‚¹å‡»

ä»£ç ï¼š
```tsx
<div className="flex gap-3 mb-4">
  <Avatar name="AI" icon={<BotIcon />} />
  <div className="flex-1">
    <div className="text-sm text-gray-500 mb-1">
      AI Agent â€¢ {formatTime(msg.timestamp)}
    </div>
    <div className="bg-blue-50 dark:bg-blue-900 p-3 rounded-lg rounded-bl-none">
      {/* æµå¼æ¸²æŸ“ markdown */}
      <Markdown>{msg.content}</Markdown>
    </div>
    {msg.actions && (
      <div className="flex gap-2 mt-2">
        {msg.actions.map(action => (
          <Button key={action.id} onClick={action.handler}>
            {action.label}
          </Button>
        ))}
      </div>
    )}
  </div>
</div>
```

#### 3. Tool Request Cardï¼ˆå·¥å…·è°ƒç”¨å¼€å§‹ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸  æ­£åœ¨è°ƒç”¨å·¥å…·               â”‚
â”‚                                â”‚
â”‚ ğŸ“Š fetch_stock_data            â”‚
â”‚  â€¢ symbol: AAPL               â”‚
â”‚  â€¢ period: 1y                 â”‚
â”‚  â€¢ indicators: [MACD, RSI]    â”‚
â”‚                                â”‚
â”‚ [â³ å¤„ç†ä¸­...] (2.3s)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä»£ç ï¼š
```tsx
<div className="bg-amber-50 dark:bg-amber-900 p-3 rounded-lg border-l-4 border-amber-500 mb-4">
  <div className="flex items-start gap-2">
    <GearIcon className="mt-1" />
    <div className="flex-1">
      <div className="font-semibold text-sm">æ­£åœ¨è°ƒç”¨å·¥å…·</div>
      <div className="mt-1 text-xs text-gray-600 dark:text-gray-300">
        <code>{toolName}</code>
      </div>
      {/* è¾“å…¥å‚æ•°åˆ—è¡¨ */}
      <div className="mt-2 space-y-1 text-xs">
        {Object.entries(toolInput).map(([key, value]) => (
          <div key={key}>â€¢ <strong>{key}</strong>: {String(value)}</div>
        ))}
      </div>
      {/* è¿›åº¦æŒ‡ç¤º */}
      <div className="mt-3 flex items-center gap-2">
        <Spinner size="sm" />
        <span className="text-xs text-gray-500">å¤„ç†ä¸­... ({elapsedTime}s)</span>
      </div>
    </div>
  </div>
</div>
```

#### 4. Tool Result Cardï¼ˆå·¥å…·ç»“æœï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å·¥å…·æ‰§è¡Œå®Œæˆ               â”‚
â”‚                                â”‚
â”‚ ğŸ“Š fetch_stock_data            â”‚
â”‚  â€¢ currentPrice: $185.23      â”‚
â”‚  â€¢ change: +2.35%             â”‚
â”‚  â€¢ PE: 28.5                   â”‚
â”‚  â€¢ Volume: 52.3M              â”‚
â”‚                                â”‚
â”‚ [æŸ¥çœ‹å›¾è¡¨] [æ˜¾ç¤ºè¯¦æƒ…]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä»£ç ï¼š
```tsx
<div className="bg-green-50 dark:bg-green-900 p-3 rounded-lg border-l-4 border-green-500 mb-4">
  <div className="flex items-start gap-2">
    <CheckCircleIcon className="text-green-600 mt-1" />
    <div className="flex-1">
      <div className="font-semibold text-sm">âœ… {toolName}</div>
      {/* ç»“æœæ‘˜è¦è¡¨æ ¼ */}
      <table className="mt-2 w-full text-xs">
        <tbody>
          {Object.entries(result).map(([key, value]) => (
            <tr key={key} className="border-b border-green-200 dark:border-green-700">
              <td className="font-semibold py-1">{key}</td>
              <td className="text-right py-1">{formatValue(value)}</td>
            </tr>
          ))}
        </tbody>
      </table>
      {/* æ“ä½œæŒ‰é’® */}
      <div className="mt-3 flex gap-2">
        <Button size="sm" variant="outline">æŸ¥çœ‹å›¾è¡¨</Button>
        <Button size="sm" variant="outline">æ˜¾ç¤ºè¯¦æƒ…</Button>
      </div>
    </div>
  </div>
</div>
```

#### 5. Thinking Summary Cardï¼ˆæ€è€ƒè¿‡ç¨‹ï¼Œå¯æŠ˜å ï¼‰
```
é»˜è®¤ï¼ˆæŠ˜å ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI æ€è€ƒä¸­                   â”‚
â”‚ [===========>      ] 65% å®Œæˆ  â”‚
â”‚                                â”‚
â”‚ [å±•å¼€] [éšè—]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å±•å¼€åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI æ€è€ƒè¿‡ç¨‹                 â”‚
â”‚ [==============] 100% å®Œæˆ    â”‚
â”‚                                â”‚
â”‚ âœ“ æ­¥éª¤ 1: è§£æç”¨æˆ·éœ€æ±‚        â”‚
â”‚   è·å–æœ€è¿‘ 5 å¹´ AAPL æ•°æ®     â”‚
â”‚                                â”‚
â”‚ âœ“ æ­¥éª¤ 2: è°ƒç”¨å·¥å…·             â”‚
â”‚   å·²è·å– OHLCVã€æŒ‡æ ‡æ•°æ®      â”‚
â”‚                                â”‚
â”‚ âœ“ æ­¥éª¤ 3: åˆ†ææ•°æ®             â”‚
â”‚   è®¡ç®—æŠ€æœ¯é¢ã€åŸºæœ¬é¢è¯„åˆ†      â”‚
â”‚                                â”‚
â”‚ [æ”¶èµ·]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä»£ç ï¼š
```tsx
const [expanded, setExpanded] = useState(false);

return (
  <div className="bg-purple-50 dark:bg-purple-900 p-3 rounded-lg border-l-4 border-purple-500 mb-4">
    <div className="flex items-start gap-2">
      <BrainIcon className="text-purple-600 mt-1" />
      <div className="flex-1">
        <button
          onClick={() => setExpanded(!expanded)}
          className="font-semibold text-sm flex items-center gap-2 hover:underline"
        >
          ğŸ§  AI æ€è€ƒè¿‡ç¨‹
          <ChevronIcon rotation={expanded ? 180 : 0} />
        </button>

        {/* è¿›åº¦æ¡ */}
        <div className="mt-2 w-full bg-purple-200 dark:bg-purple-700 rounded-full h-2">
          <div
            className="bg-purple-600 h-2 rounded-full transition-all"
            style={{ width: `${progress}%` }}
          />
        </div>

        {/* å±•å¼€å†…å®¹ */}
        {expanded && (
          <div className="mt-3 space-y-2 text-xs">
            {thinkingSteps.map((step, idx) => (
              <div key={idx} className="flex items-start gap-2">
                <CheckCircleIcon className="text-purple-600 mt-0.5" size="sm" />
                <div>
                  <strong>æ­¥éª¤ {idx + 1}: {step.title}</strong>
                  <p className="text-gray-600 dark:text-gray-300 mt-0.5">
                    {step.summary}
                  </p>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  </div>
);
```

### èŠå¤©è¾“å…¥æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤...                        â”‚
â”‚                                             â”‚
â”‚                                             â”‚
â”‚ [ğŸ“ é™„ä»¶] [ğŸ¯ æ¨¡å¼é€‰æ‹©] [â¤ å‘é€]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‰¹ç‚¹ï¼š
- æ”¯æŒå¤šè¡Œï¼ˆtextareaï¼Œæœ€å°é«˜åº¦ 3 è¡Œï¼‰
- Ctrl+Enter å¿«é€Ÿå‘é€
- æ¨¡å¼é€‰æ‹©ï¼šåˆ†ææ¨¡å¼ã€äº¤æ˜“æ¨¡å¼ã€å­¦ä¹ æ¨¡å¼
- å‘é€ä¸­ç¦ç”¨è¾“å…¥

ä»£ç ï¼š
```tsx
const [input, setInput] = useState('');
const [mode, setMode] = useState<'analysis' | 'trade' | 'learn'>('analysis');

const handleSend = async () => {
  if (!input.trim()) return;
  
  setLoading(true);
  await sendQuery({
    content: input,
    mode,
    conversationId
  });
  
  setInput('');
  setLoading(false);
};

return (
  <div className="border-t p-4 bg-white dark:bg-gray-900">
    <div className="flex gap-2 mb-2">
      <ModeSelector value={mode} onChange={setMode} />
    </div>
    <textarea
      value={input}
      onChange={(e) => setInput(e.target.value)}
      onKeyDown={(e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
          handleSend();
        }
      }}
      placeholder="è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤..."
      className="w-full p-3 border rounded-lg resize-none focus:outline-none focus:ring-2"
      rows={3}
      disabled={loading}
    />
    <div className="flex justify-end gap-2 mt-2">
      <Button variant="outline" size="sm">ğŸ“ é™„ä»¶</Button>
      <Button
        variant="primary"
        size="sm"
        onClick={handleSend}
        loading={loading}
      >
        â¤ å‘é€
      </Button>
    </div>
  </div>
);
```

---

## ğŸ“Š å³ä¾§åŒºï¼šè‚¡ç¥¨å·¥ä½œå°ï¼ˆStock Workspaceï¼‰

### é¢æ¿ç³»ç»Ÿæ¶æ„

#### é¢æ¿æ³¨å†Œè¡¨ï¼ˆPanel Registryï¼‰

```typescript
// types/panel.ts
export interface Panel {
  id: string;                      // å”¯ä¸€ ID: 'kline' | 'intraday' | ...
  title: string;                   // UI æ ‡é¢˜: 'Kçº¿' | 'åˆ†æ—¶' | ...
  icon: React.ReactNode;           // Tab å›¾æ ‡
  category: 'chart' | 'data' | 'advice';  // åˆ†ç±»
  minWidth: number;                // æœ€å°å®½åº¦ï¼ˆpxï¼‰
  defaultWidth?: number;           // é»˜è®¤å®½åº¦
  lazy: boolean;                   // æ˜¯å¦å»¶è¿ŸåŠ è½½
  dataDeps: string[];              // ä¾èµ–æ•°æ®æº: ['marketTick', 'klineHistory']
  component: React.ComponentType<PanelProps>;
  onSubscribe?: (symbol: string) => Promise<void>;
  onUnsubscribe?: (symbol: string) => void;
}

// store/panelRegistry.ts
export const panelRegistry: Record<string, Panel> = {
  kline: {
    id: 'kline',
    title: 'Kçº¿',
    icon: <CandleIcon />,
    category: 'chart',
    minWidth: 400,
    defaultWidth: 600,
    lazy: false,
    dataDeps: ['marketTick', 'klineHistory'],
    component: KLinePanel,
    onSubscribe: async (symbol) => {
      // è®¢é˜… WebSocket è¡Œæƒ…
      marketStore.subscribe(symbol);
      // è·å–å†å² K çº¿æ•°æ®
      const klines = await fetchKlineHistory(symbol, '1d', 250);
      marketStore.setKlineData(symbol, klines);
    },
  },
  
  intraday: {
    id: 'intraday',
    title: 'åˆ†æ—¶',
    icon: <LineIcon />,
    category: 'chart',
    minWidth: 400,
    defaultWidth: 600,
    lazy: true,
    dataDeps: ['marketTick'],
    component: IntradayPanel,
    onSubscribe: async (symbol) => {
      marketStore.subscribe(symbol);
      const intraday = await fetchIntradayData(symbol);
      marketStore.setIntradayData(symbol, intraday);
    },
  },
  
  orderbook: {
    id: 'orderbook',
    title: 'ç›˜å£',
    icon: <OrderBookIcon />,
    category: 'data',
    minWidth: 300,
    lazy: true,
    dataDeps: ['orderbook'],
    component: OrderBookPanel,
  },
  
  indicators: {
    id: 'indicators',
    title: 'æŒ‡æ ‡',
    icon: <ChartIcon />,
    category: 'data',
    minWidth: 300,
    lazy: true,
    dataDeps: ['stockInfo'],
    component: IndicatorsPanel,
    onSubscribe: async (symbol) => {
      const info = await fetchStockInfo(symbol);
      marketStore.setStockInfo(symbol, info);
    },
  },
  
  advice: {
    id: 'advice',
    title: 'å»ºè®®',
    icon: <LightbulbIcon />,
    category: 'advice',
    minWidth: 300,
    lazy: true,
    dataDeps: ['chatRecommendation'],
    component: AdvicePanel,
  },
  
  news: {
    id: 'news',
    title: 'èµ„è®¯',
    icon: <NewsIcon />,
    category: 'advice',
    minWidth: 300,
    lazy: true,
    dataDeps: ['news'],
    component: NewsPanel,
    onSubscribe: async (symbol) => {
      const news = await fetchNews(symbol);
      marketStore.setNews(symbol, news);
    },
  },
};
```

#### Stock Workspace å®¹å™¨

```tsx
// components/StockWorkspace.tsx
export const StockWorkspace: React.FC = () => {
  const currentSymbol = useStockStore((s) => s.currentSymbol);
  const activePanelId = useStockStore((s) => s.activePanelId);
  const setActivePanelId = useStockStore((s) => s.setActivePanelId);
  const setCurrentSymbol = useStockStore((s) => s.setCurrentSymbol);

  const activePanel = panelRegistry[activePanelId];

  return (
    <div className="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
      {/* Symbol Selector */}
      <div className="p-3 border-b bg-white dark:bg-gray-800">
        <SymbolSearchBar 
          value={currentSymbol}
          onChange={setCurrentSymbol}
        />
      </div>

      {/* Panel Tabs */}
      <div className="flex gap-1 p-2 border-b bg-white dark:bg-gray-800 overflow-x-auto">
        {Object.values(panelRegistry).map((panel) => (
          <Tab
            key={panel.id}
            active={activePanelId === panel.id}
            onClick={() => setActivePanelId(panel.id)}
            icon={panel.icon}
            label={panel.title}
          />
        ))}
      </div>

      {/* Active Panel Content */}
      <div className="flex-1 overflow-auto">
        {activePanel && (
          <Suspense fallback={<PanelSkeleton />}>
            <activePanel.component symbol={currentSymbol} />
          </Suspense>
        )}
      </div>
    </div>
  );
};
```

### å„é¢æ¿è¯¦ç»†å®ç°

#### 1. Kçº¿é¢æ¿ï¼ˆKLinePanelï¼‰

```tsx
// components/panels/KLinePanel.tsx
import { IChartApi, createChart, ColorType } from 'lightweight-charts';

export const KLinePanel: React.FC<PanelProps> = ({ symbol }) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const chartRef = useRef<IChartApi | null>(null);
  const marketData = useMarketStore((s) => s.data[symbol]);
  const klineHistory = useMarketStore((s) => s.klineHistory[symbol]);

  useEffect(() => {
    if (!containerRef.current) return;

    // 1. åˆå§‹åŒ–å›¾è¡¨
    const chart = createChart(containerRef.current, {
      layout: {
        background: { type: ColorType.Solid, color: '#1f2937' },
        textColor: '#d1d5db',
      },
      width: containerRef.current.clientWidth,
      height: containerRef.current.clientHeight,
      timeScale: {
        timeVisible: true,
        secondsVisible: false,
      },
    });

    chartRef.current = chart;

    // 2. æ·»åŠ  K çº¿ Series
    const candlestickSeries = chart.addCandlestickSeries({
      upColor: '#16a34a',
      downColor: '#dc2626',
      borderUpColor: '#16a34a',
      borderDownColor: '#dc2626',
      wickUpColor: '#16a34a',
      wickDownColor: '#dc2626',
    });

    // 3. åŠ è½½å†å²æ•°æ®
    if (klineHistory && klineHistory.length > 0) {
      const data = klineHistory.map((k) => ({
        time: k.timestamp,
        open: k.open,
        high: k.high,
        low: k.low,
        close: k.close,
      }));
      candlestickSeries.setData(data);

      // åªåœ¨é¦–æ¬¡åŠ è½½æ—¶ fitContent
      chart.timeScale().fitContent();
    }

    // 4. å®æ—¶æ›´æ–°ï¼ˆä»…æœ€åä¸€æ ¹ K çº¿ï¼‰
    const handleMarketUpdate = (tick: MarketTick) => {
      if (!chartRef.current) return;

      const lastKline = {
        time: Math.floor(tick.timestamp / 1000),
        open: tick.open,
        high: tick.high,
        low: tick.low,
        close: tick.close,
      };

      // å…³é”®ï¼šä¸è°ƒç”¨ fitContent()ï¼Œä»…æ›´æ–°æ•°æ®
      candlestickSeries.update(lastKline);
    };

    // ä½¿ç”¨ requestAnimationFrame æ‰¹å¤„ç†æ›´æ–°
    let updateQueue: MarketTick[] = [];
    let isScheduled = false;

    const flushUpdates = () => {
      if (updateQueue.length > 0) {
        const latest = updateQueue[updateQueue.length - 1];
        handleMarketUpdate(latest);
        updateQueue = [];
      }
      isScheduled = false;
    };

    const onTick = (tick: MarketTick) => {
      updateQueue.push(tick);
      if (!isScheduled) {
        isScheduled = true;
        requestAnimationFrame(flushUpdates);
      }
    };

    marketStore.on(`tick:${symbol}`, onTick);

    // 5. çª—å£ç¼©æ”¾å¤„ç†
    const handleResize = () => {
      if (containerRef.current && chartRef.current) {
        chartRef.current.applyOptions({
          width: containerRef.current.clientWidth,
          height: containerRef.current.clientHeight,
        });
      }
    };

    window.addEventListener('resize', handleResize);

    // Cleanup
    return () => {
      window.removeEventListener('resize', handleResize);
      marketStore.off(`tick:${symbol}`, onTick);
      if (chartRef.current) {
        chartRef.current.remove();
      }
    };
  }, [symbol, klineHistory]);

  return (
    <div 
      ref={containerRef} 
      className="w-full h-full"
      style={{ minHeight: '400px' }}
    />
  );
};
```

**å…³é”®ä¼˜åŒ–**ï¼š
- âŒ ç¦æ­¢æ¯æ¬¡ tick éƒ½è°ƒç”¨ `fitContent()`ï¼ˆä¼šå¯¼è‡´æ—¶é—´è½´é¢‘ç¹æŠ–åŠ¨ï¼‰
- âœ… ä½¿ç”¨ `requestAnimationFrame` æ‰¹å¤„ç†ï¼Œ250ms æœ€å¤šæ›´æ–°ä¸€æ¬¡ UI
- âœ… ä»…æ›´æ–°æœ€åä¸€æ ¹ K çº¿ï¼Œå†å²æ•°æ®ä¸å˜

#### 2. åˆ†æ—¶é¢æ¿ï¼ˆIntradayPanelï¼‰

```tsx
export const IntradayPanel: React.FC<PanelProps> = ({ symbol }) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const intradayData = useMarketStore((s) => s.intradayData[symbol]);

  useEffect(() => {
    if (!containerRef.current || !intradayData) return;

    // ä½¿ç”¨ Line Series è€Œé Candlestick
    const chart = createChart(containerRef.current, {
      layout: {
        background: { type: ColorType.Solid, color: '#1f2937' },
        textColor: '#d1d5db',
      },
      width: containerRef.current.clientWidth,
      height: containerRef.current.clientHeight,
      timeScale: { timeVisible: true, secondsVisible: true },
    });

    const lineSeries = chart.addLineSeries({
      color: '#3b82f6',
      lineWidth: 2,
    });

    const data = intradayData.map((point) => ({
      time: point.timestamp,
      value: point.price,
    }));

    lineSeries.setData(data);
    chart.timeScale().fitContent();

    return () => chart.remove();
  }, [intradayData, symbol]);

  return (
    <div 
      ref={containerRef} 
      className="w-full h-full"
      style={{ minHeight: '400px' }}
    />
  );
};
```

#### 3. ç›˜å£é¢æ¿ï¼ˆOrderBookPanelï¼‰

```tsx
export const OrderBookPanel: React.FC<PanelProps> = ({ symbol }) => {
  const orderbook = useMarketStore((s) => s.orderbook[symbol]);

  if (!orderbook) return <PanelSkeleton />;

  const { bids, asks, mid } = orderbook;

  return (
    <div className="p-4 space-y-4">
      {/* ä¸­é—´ä»·æ ¼ */}
      <div className="text-center">
        <div className="text-3xl font-bold">{mid.price}</div>
        <div className={`text-lg ${mid.change > 0 ? 'text-green-600' : 'text-red-600'}`}>
          {mid.change > 0 ? '+' : ''}{mid.change} ({mid.changePercent}%)
        </div>
      </div>

      {/* ç›˜å£æ•°æ® */}
      <div className="grid grid-cols-3 gap-4 text-sm">
        {/* ä¹°å• */}
        <div className="bg-green-50 dark:bg-green-900 p-3 rounded">
          <div className="font-semibold mb-2 text-green-700">ä¹°ç›˜</div>
          <table className="w-full text-xs">
            <tbody>
              {bids.slice(0, 5).map((bid, idx) => (
                <tr key={idx} className="border-b">
                  <td className="py-1">Â¥{bid.price}</td>
                  <td className="text-right py-1">{bid.volume}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        {/* ä¸­é—´ç©ºç™½ */}
        <div className="flex items-center justify-center">
          <div className="text-gray-500 text-xs">ä¹° / å–</div>
        </div>

        {/* å–å• */}
        <div className="bg-red-50 dark:bg-red-900 p-3 rounded">
          <div className="font-semibold mb-2 text-red-700">å–ç›˜</div>
          <table className="w-full text-xs">
            <tbody>
              {asks.slice(0, 5).map((ask, idx) => (
                <tr key={idx} className="border-b">
                  <td className="py-1">Â¥{ask.price}</td>
                  <td className="text-right py-1">{ask.volume}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};
```

#### 4. æŒ‡æ ‡é¢æ¿ï¼ˆIndicatorsPanelï¼‰

```tsx
export const IndicatorsPanel: React.FC<PanelProps> = ({ symbol }) => {
  const stockInfo = useMarketStore((s) => s.stockInfo[symbol]);

  if (!stockInfo) return <PanelSkeleton />;

  const indicators = [
    { label: 'PE æ¯”ç‡', value: stockInfo.pe, status: stockInfo.pe < 15 ? 'low' : 'normal' },
    { label: 'PB æ¯”ç‡', value: stockInfo.pb, status: stockInfo.pb < 1.5 ? 'low' : 'normal' },
    { label: 'ROE', value: `${stockInfo.roe}%`, status: stockInfo.roe > 15 ? 'high' : 'normal' },
    { label: 'å¸‚å€¼', value: formatLargeNumber(stockInfo.marketCap) },
    { label: 'æµé€šè‚¡', value: formatLargeNumber(stockInfo.floatShare) },
    { label: 'è‚¡æ¯ç‡', value: `${stockInfo.dividendYield}%` },
  ];

  return (
    <div className="p-4 space-y-3">
      {indicators.map((ind) => (
        <div key={ind.label} className="flex justify-between items-center p-3 bg-gray-100 dark:bg-gray-800 rounded">
          <span className="text-sm font-semibold">{ind.label}</span>
          <span className={`text-lg font-bold ${
            ind.status === 'low' ? 'text-green-600' : ind.status === 'high' ? 'text-blue-600' : ''
          }`}>
            {ind.value}
          </span>
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ”Œ æ•°æ®æµä¸è®¢é˜…æ¨¡å‹

### æ•°æ®ä¾èµ–å…³ç³»
```
ç”¨æˆ·é€‰æ‹© Symbol (AAPL)
         â†“
    æ¿€æ´»é¢æ¿ (Panel Tab)
         â†“
   è§¦å‘ onSubscribe() å›è°ƒ
         â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   æ•°æ®è®¢é˜…å¼€å§‹           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ 1. marketStore.subscribe(symbol)    â”‚
   â”‚    â†’ å»ºç«‹ WebSocket è¿æ¥               â”‚
   â”‚    â†’ å¼€å§‹æ¥æ”¶ tick äº‹ä»¶                â”‚
   â”‚                        â”‚
   â”‚ 2. fetchKlineHistory(symbol, ...) â”‚
   â”‚    â†’ REST è·å–å†å² K çº¿             â”‚
   â”‚    â†’ ç¼“å­˜åˆ° React Query              â”‚
   â”‚                        â”‚
   â”‚ 3. fetchStockInfo(symbol)         â”‚
   â”‚    â†’ REST è·å–æŒ‡æ ‡æ•°æ®               â”‚
   â”‚    â†’ ç¼“å­˜ 5 åˆ†é’Ÿ                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   å„é¢æ¿æ¥æ”¶æ•°æ®æ›´æ–°
         â†“
   UI æ¸²æŸ“ï¼ˆé€å¸§æ›´æ–°ï¼Œä¸å¡é¡¿ï¼‰
```

### Zustand Store ç»“æ„

```typescript
// store/marketStore.ts
interface MarketState {
  // å½“å‰å¸‚åœºæ•°æ®ï¼ˆå®æ—¶ï¼‰
  data: Record<string, MarketTick>;
  
  // å†å² K çº¿
  klineHistory: Record<string, KLine[]>;
  
  // åˆ†æ—¶æ•°æ®
  intradayData: Record<string, IntradayPoint[]>;
  
  // ç›˜å£æ•°æ®
  orderbook: Record<string, OrderBook>;
  
  // è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
  stockInfo: Record<string, StockInfo>;
  
  // æ–°é—»èµ„è®¯
  news: Record<string, News[]>;
  
  // Actions
  setMarketTick: (symbol: string, tick: MarketTick) => void;
  setKlineData: (symbol: string, klines: KLine[]) => void;
  setOrderBook: (symbol: string, book: OrderBook) => void;
  subscribe: (symbol: string) => void;
  unsubscribe: (symbol: string) => void;
}

export const useMarketStore = create<MarketState>((set) => ({
  data: {},
  klineHistory: {},
  intradayData: {},
  orderbook: {},
  stockInfo: {},
  news: {},
  
  setMarketTick: (symbol, tick) =>
    set((state) => ({
      data: { ...state.data, [symbol]: tick },
    })),
  
  setKlineData: (symbol, klines) =>
    set((state) => ({
      klineHistory: { ...state.klineHistory, [symbol]: klines },
    })),
  
  subscribe: (symbol) => {
    // è¿æ¥ WebSocket æˆ–å¯åŠ¨æ•°æ®æ¨é€
    if (!wsRef.current) {
      wsRef.current = new WebSocket('wss://market-api/ws');
    }
    wsRef.current.send(JSON.stringify({ action: 'subscribe', symbol }));
  },
  
  unsubscribe: (symbol) => {
    if (wsRef.current) {
      wsRef.current.send(JSON.stringify({ action: 'unsubscribe', symbol }));
    }
  },
}));
```

---

## ğŸ¨ æ ·å¼ä¸ä¸»é¢˜

### Tailwind é…ç½®ï¼ˆæš—è‰²ä¼˜å…ˆï¼‰
```js
// tailwind.config.js
module.exports = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        up: '#16a34a',      // æ¶¨ï¼ˆç»¿ï¼‰
        down: '#dc2626',    // è·Œï¼ˆçº¢ï¼‰
        neutral: '#6b7280', // ä¸­æ€§
      },
      fontFamily: {
        mono: ['Fira Code', 'monospace'],
      },
    },
  },
};
```

### å…¨å±€æ ·å¼
```css
/* app/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #9ca3af;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* æ·±è‰²æ¨¡å¼ */
.dark ::-webkit-scrollbar-thumb {
  background: #4b5563;
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* åŠ¨ç”» */
@keyframes pulse-fast {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.animate-pulse-fast {
  animation: pulse-fast 200ms ease-in-out;
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–æ¸…å•

| ä¼˜åŒ–é¡¹ | å®ç°æ–¹æ¡ˆ | éªŒæ”¶æ ‡å‡† |
|--------|---------|---------|
| ä»£ç åˆ†å‰² | `React.lazy` + `Suspense` å»¶è¿ŸåŠ è½½é¢æ¿ | Chunk å¤§å° < 100KB æ¯ä¸ª |
| æ•°æ®ç¼“å­˜ | React Query (staleTime, gcTime) | API é‡å¤è°ƒç”¨å‡å°‘ 90% |
| å®æ—¶æ›´æ–°æ‰¹å¤„ç† | `requestAnimationFrame` åˆå¹¶ tick | 60fps æ— æŠ–åŠ¨ï¼ˆLighthouseï¼‰ |
| å†…å­˜æ³„æ¼ | useEffect cleanup æ¸…ç† WS/SSE | DevTools Memory ç¨³å®šå¢é•¿ < 5MB/min |
| å›¾è¡¨ä¼˜åŒ– | ç¦æ­¢é¢‘ç¹ fitContentã€ä»…æ›´æ–°æœ€å bar | FCP < 1.5sã€LCP < 2.5s |

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-01-29  
**ç”¨é€”**: å‰ç«¯å·¥ç¨‹åŒ–æŒ‡å—ï¼Œæ”¯æ’‘ Agent å¼€å‘